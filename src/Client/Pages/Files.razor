@page "/files/{*Path}"
@using WebServerManager.Client.Services
@inherits WebServerManager.Client.Components.PathComponentBase
@inject CredentialService CredentialService
@inject NavigationManager NavigationManager
@inject FileSystemService FileSystem
@inject IDialogService DialogService

<PageTitle>@Path</PageTitle>

<MudPaper Elevation="3" Class="mb-4 mud-dark">
	<MudStack Row="true" Justify="Justify.SpaceBetween">
		<MudBreadcrumbs Items="PathItems"/>
		<MudStack Row="true" Justify="Justify.FlexEnd" Class="align-center">
			@if (BackgroundLoadingFiles)
			{
				<MudProgressCircular Color="Color.Success" Class="ms-n1 mr-3" Size="Size.Small" Indeterminate="true"/>
			}
			else if(FileEntries != null)
			{
				<MudIconButton Color="Color.Success" Size="Size.Medium" Icon="@Icons.Material.Filled.Cached"
				               OnClick="UpdateFiles"/>
			}
			<MudButtonGroup OverrideStyles="false" Class="align-center mr-3" Style="white-space: nowrap">
				<MudButton Color="Color.Default" Variant="Variant.Outlined" Size="Size.Medium" OnClick="CreateDirectory">Create Directory</MudButton>
				<MudButton Color="Color.Primary" Variant="Variant.Filled" Size="Size.Medium">Upload</MudButton>
				<MudButton Color="Color.Primary" Variant="Variant.Filled" Size="Size.Medium" OnClick="CreateFile">New File</MudButton>
			</MudButtonGroup>
		</MudStack>
	</MudStack>
</MudPaper>

@if (FileEntries != null)
{
	<MudList Clickable="true" Dense="true" DisablePadding="true">
		@foreach (var file in FileEntries)
		{
			<MudPaper Elevation="1" Class="mb-1">
					<MudListItem Href="@(GetLinkFOrFileEntry(file))">
						<MudStack Row="true" Justify="Justify.FlexStart">
							<MudIcon Icon="@(file.IsFolder ? Icons.Custom.Uncategorized.Folder : Icons.Custom.FileFormats.FileDocument)"/>
							<MudText>@file.Name</MudText>
						</MudStack>
					</MudListItem>
				</MudPaper>
		}
	</MudList>
}
else
{
	<MudStack Row="true" Justify="Justify.Center">
		<MudProgressCircular Class="ms-n1" Size="Size.Large" Indeterminate="true"/>
	</MudStack>
}